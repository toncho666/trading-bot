# Инструкции когда запускать
on:
  schedule:
    - cron: "0 * * * *"  # Запуск в 0 минут каждого часа (начало часа)
  workflow_dispatch:     # Возможность ручного запуска из интерфейса GitHub

# Инструкции что запускать
jobs: # Список задач
  run:
    runs-on: ubuntu-latest  # запускать на свежей виртуальной машине Ubuntu

    environment: ai_env   # Секреты из окружения ai_env
    env:
      DB_HOST: ${{ secrets.DB_HOST }}
      DB_NAME: ${{ secrets.DB_NAME }}
      DB_USER: ${{ secrets.DB_USER }}
      DB_PASS: ${{ secrets.DB_PASS }}
      TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}

    # Шаги выполнения 
    steps:
      - uses: actions/checkout@v3       # Скачай код иэ этого репозитория
      
      - uses: actions/setup-python@v4   # Установи Python
        with: 
          python-version: "3.10"        # с параметрами версии

      # Установка используемых в коде библиотек
      - name: Install dependencies
        run: pip install -r requirements.txt

      # 1Шаг для отладки
      - name: Debug DB variables
        run: env | grep DB_ # Показываем все  переменные с префиксом "DB_"

      # 2Шаг для отладки
      - name: Debug TG variables
        run: env | grep TELEGRAM_ # Показываем все  переменные с префиксом "TELEGRAM_"
        
      # Основной шаг - запуск исполняемого модуля
      - name: Run strategies
        run: python runner.py   # Файл запуска всех стратегий
